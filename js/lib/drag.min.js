"use strict";define(["yua"],function(){function e(e,t,a){var i=e.getAttribute(t);if(i)for(var n,d=0;n=a[d++];)if(n.hasOwnProperty(i)&&"function"==typeof n[i])return n[i]}yua.directive("drag",{priority:1500,init:function(t){t.expr='"'+t.expr+'"',yua(t.element).css("cursor","move"),t.beforedrag=e(t.element,"data-beforedrag",t.vmodels),t.dragging=e(t.element,"data-dragging",t.vmodels),t.dragged=e(t.element,"data-dragged",t.vmodels),t.overflow=!!t.element.dataset.overflow,t.axis="xy",t.element.dataset.axis&&(t.axis=t.element.dataset.axis,delete t.element.dataset.axis),t.limit=!1,t.element.dataset.limit&&(t.limit=t.element.dataset.limit,delete t.element.dataset.limit),t.limit===!1&&(t.overflow=!0),delete t.element.dataset.overflow,delete t.element.dataset.beforedrag,delete t.element.dataset.dragging,delete t.element.dataset.dragged},update:function(e){for(var t=this,a=e?this.element.parentNode:this.element,i=yua(this.element),n=yua(document),d=null,o=null;e&&a&&!a.classList.contains(e)&&a.id!==e;)a=a.parentNode;d=yua(a),"parent"===this.limit&&(o=a.parentNode);var r,l,s,m,g,f,u,c,p,v,x,y;i.bind("mousedown",function(e){var i=getComputedStyle(a),b=i.transform.replace(/matrix\((.*)\)/,"$1"),h=d.offset();b="none"!==b?b.split(", "):[1,0,0,1,0,0],b[4]-=0,b[5]-=0,r=b[4],l=b[5],x=document.body.scrollTop,y=document.body.scrollLeft,g=h.left-r-y,f=h.top-l-x,s=e.pageX,m=e.pageY,p=window.innerWidth,v=window.innerHeight,u=a.clientWidth,c=a.clientHeight,t.beforedrag&&t.beforedrag.call(t.vmodels,a,g,f);var w=[0,v-c,0,p-u];if("parent"===t.limit){var H=getComputedStyle(o),N=H.transform.replace(/matrix\((.*)\)/,"$1"),W=yua(o).offset();N="none"!==N?N.split(", "):[1,0,0,1,0,0];var C=W.left-N[4]-y,L=W.top-N[5]-x;w=[L,L+o.clientHeight-c,C,C+o.clientWidth-u]}var S=n.bind("mousemove",function(e){"y"!==t.axis&&(b[4]=e.pageX-s+r),"x"!==t.axis&&(b[5]=e.pageY-m+l);var i=g+b[4],n=f+b[5];t.overflow||("y"!==t.axis&&(i<=w[2]&&(i=w[2],b[4]=i-g),i>=w[3]&&(i=w[3],b[4]=i-g)),"x"!==t.axis&&(n<=w[0]&&(n=w[0],b[5]=n-f),n>=w[1]&&(n=w[1],b[5]=n-f))),d.css({transform:"matrix("+b.join(", ")+")"}),t.dragging&&t.dragging.call(t.vmodels,a,i,n),e.preventDefault()}),X=n.bind("mouseup",function(){n.unbind("mousemove",S),n.unbind("mouseup",X),t.dragged&&t.dragged.call(t.vmodels,a,fox,foy)})})}})});