"use strict";define(["yua"],function(){function e(e,t,a){var n=e.getAttribute(t);if(n)for(var i,d=0;i=a[d++];)if(i.hasOwnProperty(n)&&"function"==typeof i[n])return i[n]}yua.ui.drag="1.0.0",yua.directive("drag",{priority:1500,init:function(t){t.expr='"'+t.expr+'"',yua(t.element).css("cursor","move"),t.beforedrag=e(t.element,"data-beforedrag",t.vmodels),t.dragging=e(t.element,"data-dragging",t.vmodels),t.dragged=e(t.element,"data-dragged",t.vmodels),t.overflow=!0,t.axis="xy",t.element.dataset.axis&&(t.axis=t.element.dataset.axis,delete t.element.dataset.axis),t.limit=!1,t.element.dataset.limit&&(t.limit=t.element.dataset.limit,t.overflow=!1,delete t.element.dataset.limit),delete t.element.dataset.beforedrag,delete t.element.dataset.dragging,delete t.element.dataset.dragged},update:function(e){for(var t=this,a=e?this.element.parentNode:this.element,n=yua(this.element),i=yua(document),d=null,r=null;e&&a&&!a.classList.contains(e)&&a.id!==e;)a=a.parentNode;d=yua(a),"parent"===this.limit&&(r=a.parentNode);var l,o,s,m,g,u,f,c,p,v,x,y,h,b;n.bind("mousedown",function(e){var n=getComputedStyle(a).transform.replace(/matrix\((.*)\)/,"$1"),w=d.offset();if(n="none"!==n?n.split(", "):[1,0,0,1,0,0],n[4]-=0,n[5]-=0,l=n[4],o=n[5],h=document.documentElement.scrollTop,b=document.documentElement.scrollLeft,g=w.left-l-b,u=w.top-o-h,s=e.pageX,m=e.pageY,x=window.innerWidth,y=window.innerHeight,p=a.clientWidth,v=a.clientHeight,!t.beforedrag||!1!==t.beforedrag.call(t.vmodels,a,g,u)){var H=[0,y-v,0,x-p];if("parent"===t.limit){var N=getComputedStyle(r).transform.replace(/matrix\((.*)\)/,"$1"),W=yua(r).offset();N="none"!==N?N.split(", "):[1,0,0,1,0,0];var C=W.left-N[4]-b,E=W.top-N[5]-h;H=[E,E+r.clientHeight-v,C,C+r.clientWidth-p]}var L=i.bind("mousemove",function(e){"y"!==t.axis&&(n[4]=e.pageX-s+l),"x"!==t.axis&&(n[5]=e.pageY-m+o),f=g+n[4],c=u+n[5],t.overflow||("y"!==t.axis&&(f<=H[2]&&(f=H[2],n[4]=f-g),f>=H[3]&&(f=H[3],n[4]=f-g)),"x"!==t.axis&&(c<=H[0]&&(c=H[0],n[5]=c-u),c>=H[1]&&(c=H[1],n[5]=c-u))),d.css({transform:"matrix("+n.join(", ")+")"}),t.dragging&&t.dragging.call(t.vmodels,a,f,c),e.preventDefault()}),S=i.bind("mouseup",function(e){i.unbind("mousemove",L),i.unbind("mouseup",S),t.dragged&&t.dragged.call(t.vmodels,a,f,c)})}})}})});