"use strict";define(["yua"],function(){function e(e,t,a){var i=e.getAttribute(t);if(i)for(var n,d=0;n=a[d++];)if(n.hasOwnProperty(i)&&"function"==typeof n[i])return n[i]}yua.ui.drag="1.0.0",yua.directive("drag",{priority:1500,init:function(t){t.expr='"'+t.expr+'"',yua(t.element).css("cursor","move"),t.beforedrag=e(t.element,"data-beforedrag",t.vmodels),t.dragging=e(t.element,"data-dragging",t.vmodels),t.dragged=e(t.element,"data-dragged",t.vmodels),t.overflow=!0,t.axis="xy",t.element.dataset.axis&&(t.axis=t.element.dataset.axis,delete t.element.dataset.axis),t.limit=!1,t.element.dataset.limit&&(t.limit=t.element.dataset.limit,t.overflow=!1,delete t.element.dataset.limit),delete t.element.dataset.beforedrag,delete t.element.dataset.dragging,delete t.element.dataset.dragged},update:function(e){for(var t=this,a=e?this.element.parentNode:this.element,i=yua(this.element),n=yua(document),d=null,r=null;e&&a&&!a.classList.contains(e)&&a.id!==e;)a=a.parentNode;d=yua(a),"parent"===this.limit&&(r=a.parentNode);var o,l,s,m,g,u,f,c,p,v,y,x,b,h;i.bind("mousedown",function(e){var i=getComputedStyle(a).transform.replace(/matrix\((.*)\)/,"$1"),w=d.offset();(i="none"!==i?i.split(", "):[1,0,0,1,0,0])[4]-=0,i[5]-=0,o=i[4],l=i[5],b=document.body.scrollTop,h=document.body.scrollLeft,g=w.left-o-h,u=w.top-l-b,s=e.pageX,m=e.pageY,y=window.innerWidth,x=window.innerHeight,p=a.clientWidth,v=a.clientHeight,t.beforedrag&&t.beforedrag.call(t.vmodels,a,g,u);var H=[0,x-v,0,y-p];if("parent"===t.limit){var N=getComputedStyle(r).transform.replace(/matrix\((.*)\)/,"$1"),W=yua(r).offset();N="none"!==N?N.split(", "):[1,0,0,1,0,0];var C=W.left-N[4]-h,L=W.top-N[5]-b;H=[L,L+r.clientHeight-v,C,C+r.clientWidth-p]}var S=n.bind("mousemove",function(e){"y"!==t.axis&&(i[4]=e.pageX-s+o),"x"!==t.axis&&(i[5]=e.pageY-m+l),f=g+i[4],c=u+i[5],t.overflow||("y"!==t.axis&&(f<=H[2]&&(f=H[2],i[4]=f-g),f>=H[3]&&(f=H[3],i[4]=f-g)),"x"!==t.axis&&(c<=H[0]&&(c=H[0],i[5]=c-u),c>=H[1]&&(c=H[1],i[5]=c-u))),d.css({transform:"matrix("+i.join(", ")+")"}),t.dragging&&t.dragging.call(t.vmodels,a,f,c),e.preventDefault()}),X=n.bind("mouseup",function(e){n.unbind("mousemove",S),n.unbind("mouseup",X),t.dragged&&t.dragged.call(t.vmodels,a,f,c)})})}})});