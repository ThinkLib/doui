"use strict";define(["yua"],function(){function e(e,t,a){var i=e.getAttribute(t);if(i)for(var n,r=0;n=a[r++];)if(n.hasOwnProperty(i)&&"function"==typeof n[i])return n[i]}yua.ui.drag="0.0.1",yua.directive("drag",{priority:1500,init:function(t){t.expr='"'+t.expr+'"',yua(t.element).css("cursor","move"),t.beforedrag=e(t.element,"data-beforedrag",t.vmodels),t.dragging=e(t.element,"data-dragging",t.vmodels),t.dragged=e(t.element,"data-dragged",t.vmodels),t.overflow=!0,t.axis="xy",t.element.dataset.axis&&(t.axis=t.element.dataset.axis,delete t.element.dataset.axis),t.limit=!1,t.element.dataset.limit&&(t.limit=t.element.dataset.limit,t.overflow=!1,delete t.element.dataset.limit),delete t.element.dataset.beforedrag,delete t.element.dataset.dragging,delete t.element.dataset.dragged},update:function(e){for(var t=this,a=e?this.element.parentNode:this.element,i=yua(this.element),n=yua(document),r=null,d=null;e&&a&&!a.classList.contains(e)&&a.id!==e;)a=a.parentNode;r=yua(a),"parent"===this.limit&&(d=a.parentNode);var o,l,s,m,g,u,f,c,p,v,y,x;i.bind("mousedown",function(e){var i=getComputedStyle(a),b=i.transform.replace(/matrix\((.*)\)/,"$1"),h=r.offset();b="none"!==b?b.split(", "):[1,0,0,1,0,0],b[4]-=0,b[5]-=0,o=b[4],l=b[5],y=document.body.scrollTop,x=document.body.scrollLeft,g=h.left-o-x,u=h.top-l-y,s=e.pageX,m=e.pageY,p=window.innerWidth,v=window.innerHeight,f=a.clientWidth,c=a.clientHeight,t.beforedrag&&t.beforedrag.call(t.vmodels,a,g,u);var w=[0,v-c,0,p-f];if("parent"===t.limit){var H=getComputedStyle(d),N=H.transform.replace(/matrix\((.*)\)/,"$1"),W=yua(d).offset();N="none"!==N?N.split(", "):[1,0,0,1,0,0];var C=W.left-N[4]-x,L=W.top-N[5]-y;w=[L,L+d.clientHeight-c,C,C+d.clientWidth-f]}var S=n.bind("mousemove",function(e){"y"!==t.axis&&(b[4]=e.pageX-s+o),"x"!==t.axis&&(b[5]=e.pageY-m+l);var i=g+b[4],n=u+b[5];t.overflow||("y"!==t.axis&&(i<=w[2]&&(i=w[2],b[4]=i-g),i>=w[3]&&(i=w[3],b[4]=i-g)),"x"!==t.axis&&(n<=w[0]&&(n=w[0],b[5]=n-u),n>=w[1]&&(n=w[1],b[5]=n-u))),r.css({transform:"matrix("+b.join(", ")+")"}),t.dragging&&t.dragging.call(t.vmodels,a,i,n),e.preventDefault()}),X=n.bind("mouseup",function(){n.unbind("mousemove",S),n.unbind("mouseup",X),t.dragged&&t.dragged.call(t.vmodels,a,fox,foy)})})}})});