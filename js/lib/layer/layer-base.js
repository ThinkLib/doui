"use strict";define(["yua","lib/drag","css!./skin/def"],function(t){function i(){return"layer-"+ ++a}function e(i){if("string"!=typeof i&&"number"!=typeof i)return console.error(new Error("要关闭的layer实例不存在"));if(/^\$wrap\-/.test(i)||r["$wrap-"+i])try{if(i=(r["$wrap-"+i]?"$wrap-":"")+i,!r[i].show)return;r[i].parentElem.replaceChild(r[i].wrap,o[i][1])}catch(e){}else{try{document.body.removeChild(o[i][1]),document.body.removeChild(o[i][0])}catch(e){}delete o[i],delete t.vmodels[i]}}function n(t,i){for(var e=0,n="";i>e;)n+=t,e++;return n}function s(t){return t||0===t?t:"auto"}var o={},r={},a=0,c={type:1,skin:"def",icon:1,background:"#fff",shade:!0,shadeClose:!1,radius:"0px",area:["auto","auto"],title:"",menubar:!0,content:"",fixed:!1,offset:null,btns:["确定","取消"],yes:e,no:e,success:null},d=function(t){t&&this.ready(t).append().show()},l={alert:function(t,i){return i="function"==typeof i?{yes:i}:"object"==typeof i?i:{},i.icon=6,i.content=t,l.open(i)},confirm:function(t,i){return i="function"==typeof i?{yes:i}:"object"==typeof i?i:{},i.type=2,i.icon=8,i.content=t,l.open(i)},msg:function(t,i){if("object"==typeof i)i=i;else{var e=i;i={timeout:2500},"number"==typeof e&&(i.icon=e)}return i.hasOwnProperty("timeout")||(i.timeout=2500),i.specialMode=!0,i.content='<p class="msg-box">'+t+"</p>",i.type=7,i.fixed=!0,i.shade=!1,i.menubar=!1,i.radius="5px",l.open(i)},loading:function(i,e,n){return i>>>=0,"function"==typeof e?(n=e,e=0):(e>>>=0,"function"!=typeof n&&(n=t.noop)),l.open({type:6,load:i,yes:n,timeout:e,menubar:!1,background:"none",fixed:!0})},tips:function(i){t.log(i)},prompt:function(i,e){if("function"!=typeof e)return console.error("argument [callback] requires a function, but "+typeof e+" given");var n={type:3,icon:7,prompt:"",title:i,content:'<input class="prompt-value" :duplex="prompt" />',yes:function(i){e(i,t.vmodels[i].prompt)}};return l.open(n)},use:function(t,i){require(["css!./skin/"+t],i)},close:e,open:function(i){if("string"!=typeof i)return new d(i).init.$id;if(i="$wrap-"+i,!r[i])throw new Error("layer实例不存在");r[i].show||(r[i].show=!0,t.vmodels[i]||t.define(r[i].obj.init),t.scan(o[i][1]),r[i].obj.show(),r[i].parentElem.appendChild(o[i][1]),r[i].parentElem.replaceChild(o[i][1],r[i].wrap))},version:"0.0.1-base"};return d.prototype={dot:{0:4,1:9,2:2,3:3,4:2,5:5,6:5,7:5},timeout:null,create:function(){var t=document.createElement("div"),i=document.createElement("div");i.className="do-layer-cover type-"+this.init.type,this.init.shadeClose&&(i.setAttribute(":controller",this.cInit.$id),i.setAttribute(":click","close('"+this.init.$id+"')")),t.className="do-layer skin-"+this.init.skin+" type-"+(this.init.specialMode||7!==this.init.type?this.init.type:"unspecial"),t.style.visibility="hidden",t.style.borderRadius=this.init.radius,t.setAttribute(":controller",this.init.$id),this.init.menubar||this.init.fixed||(t.setAttribute(":drag",""),t.setAttribute("data-limit","window"));var e="";return"auto"!==this.init.area[0]&&(e+="width: "+this.init.area[0]+";"),"auto"!==this.init.area[1]&&(e+="height: "+this.init.area[1]+";"),t.innerHTML=this.getMenubar()+'<div class="layer-content do-fn-cl" style="'+e+'">'+this.getCont()+"</div>"+this.getBtns(),[this.init.shade?i:null,t]},getCont:function(){return 6===this.init.type?this.getLoading(this.init.load):this.getIcon()+'<div class="detail" :html="content"></div>'},getLoading:function(t){return'<div class="do-ui-load load-style-'+t+'"><span class="dot-box">'+n("<i></i>",this.dot[t])+"</span></div>"},getMenubar:function(){var t="";return this.init.menubar&&(t+='<div class="layer-title do-fn-noselect" ',this.init.fixed||(t+=':drag="do-layer" data-limit="window" '),t+='>{{title}}<a class="action-close deficon" :click="no(\''+this.init.$id+"')\"></a></div>"),t},getIcon:function(){return 0===this.init.icon?"":this.init.type<4||5===this.init.type||this.init.specialMode?'<span class="deficon icon-'+this.init.icon+'"></span>':""},getBtns:function(){if(this.init.type>3)return"";var t='<div class="layer-btns do-fn-noselect">';return t+=this.init.type>1?'<a href="javascript:;" class="action-no" :click="no(\''+this.init.$id+'\')" :text="btns[1]"></a><a href="javascript:;" class="action-yes" :click="yes(\''+this.init.$id+'\')" :text="btns[0]"></a>':'<a href="javascript:;" class="action-yes" :click="yes(\''+this.init.$id+'\')" :text="btns[0]"></a>',t+="</div>"},append:function(){return o[this.init.$id]=this.create(),o[this.init.$id][0]&&(document.body.appendChild(o[this.init.$id][0]),this.init.shadeClose&&(t.define(this.cInit),t.scan(o[this.init.$id][0]))),document.body.appendChild(o[this.init.$id][1]),t.define(this.init),t.scan(o[this.init.$id][1]),this},show:function(){var i=this;setTimeout(function(){var e={visibility:"",background:i.init.background};if(i.init.offset)e.top=s(i.init.offset[0]),e.right=s(i.init.offset[1]),e.bottom=s(i.init.offset[2]),e.left=s(i.init.offset[3]);else{var n=getComputedStyle(o[i.init.$id][1]);e=t.mix(e,{marginLeft:-parseInt(n.width)/2,marginTop:-parseInt(n.height)/2})}t(o[i.init.$id][1]).css(e)},0),this.init.success&&"function"==typeof this.init.success&&this.init.success(this.init.$id),this.init.type>3&&(this.init.timeout>0?(clearTimeout(this.timeout),this.timeout=setTimeout(function(){clearTimeout(i.timeout),l.close(i.init.$id),6===i.init.type&&i.init.yes(i.init.$id)},this.init.timeout)):6===this.init.type&&this.init.yes(this.init.$id))},ready:function(n){return this.init=t.mix({},c,n),this.init.$id||(this.init.$id=i()),this.init.icon>17&&(this.icon.icon=17),4===this.init.type&&(this.icon.type=7),this.cInit={$id:this.init.$id+"-c",close:this.init.shadeClose?e:t.noop},this}},t.directive("layer",{priority:1400,init:function(t){t.param||(t.element.style.display="none")},update:function(t){if(!t)return console.error(new Error(":layer指令格式不正确或无效属性. ["+this.name+'="'+this.expr)+'"]');var i=Object.assign({},this.element.dataset);if(this.param)"tips"===this.param&&"static"===getComputedStyle(this.element.parentNode).position&&(this.element.parentNode.style.position="relative");else{i.type=7,i.$id="$wrap-"+t,i.hasOwnProperty("menubar")||(i.menubar=!1);var e=(new d).ready(i);e.init.content=this.element.cloneNode(!0),r[e.init.$id]={obj:e,parentElem:this.element.parentNode,wrap:this.element,show:!1},o[e.init.$id]=e.create()}}}),window.layer||(window.layer=l),l});