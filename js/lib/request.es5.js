"use strict";define(function(){function serialize(t,e,r){var o;if(Array.isArray(e))e.forEach(function(e,s){o=t?t+"["+(Array.isArray(e)?s:"")+"]":s,"object"==typeof e?serialize(o,e,r):r(o,e)});else for(var s in e)o=t?t+"["+s+"]":s,"object"==typeof e[s]?serialize(o,e[s],r):r(o,e[s])}var _request=function(t,e){this.transport=!0,e=(e+"").trim().toUpperCase(),this.xhr=Xhr(),this.opt={url:(t+"").trim(),type:e||"GET",form:"",data:{},headers:{},timeoutID:0,uuid:Math.random().toString(16).substr(2)}},_requestp=_request.prototype,toS=Object.prototype.toString,win=window,doc=win.document,encode=encodeURIComponent,decode=decodeURIComponent,noop=function(t){if(t)throw new Error(t+"")},rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,isLocal=!1;try{isLocal=rlocalProtocol.test(location.protocol)}catch(e){}var rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm;win.Xhr=function(){return new XMLHttpRequest};var Format=function(){this.tagHooks=new function(){this.option=doc.createElement("select"),this.thead=doc.createElement("table"),this.td=doc.createElement("tr"),this.area=doc.createElement("map"),this.tr=doc.createElement("tbody"),this.col=doc.createElement("colgroup"),this.legend=doc.createElement("fieldset"),this._default=doc.createElement("div"),this.g=doc.createElementNS("http://www.w3.org/2000/svg","svg"),this.optgroup=this.option,this.tbody=this.tfoot=this.colgroup=this.caption=this.thead,this.th=this.td};var t=this;"circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use".replace(/,/g,function(e){t.tagHooks[e]=t.tagHooks.g}),this.rtagName=/<([\w:]+)/,this.rxhtml=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,this.scriptTypes={"text/javascript":1,"text/ecmascript":1,"application/ecmascript":1,"application/javascript":1},this.rhtml=/<|&#?\w+;/};Format.prototype={parseJS:function(code){if(code=(code+"").trim())if(1===code.indexOf("use strict")){var script=doc.createElement("script");script.text=code,doc.head.appendChild(script).parentNode.removeChild(script)}else eval(code)},parseXML:function(t,e,r){try{r=new DOMParser,e=r.parseFromString(t,"text/xml")}catch(o){e=void 0}return e&&e.documentElement&&!e.getElementsByTagName("parsererror").length||console.error("Invalid XML: "+t),e},parseHTML:function(t){var e=doc.createDocumentFragment().cloneNode(!1);if("string"!=typeof t)return e;if(!this.rhtml.test(t))return e.appendChild(document.createTextNode(t)),e;t=t.replace(this.rxhtml,"<$1></$2>").trim();var r=(this.rtagName.exec(t)||["",""])[1].toLowerCase(),o=this.tagHooks[r]||this.tagHooks._default,s=null;o.innerHTML=t;var i=o.getElementsByTagName("script");if(i.length)for(var a,n=0;a=i[n++];)if(this.scriptTypes[a.type]){var p=doc.createElement("script").cloneNode(!1);a.attributes.forEach(function(t){p.setAttribute(t.name,t.value)}),p.text=a.text,a.parentNode.replaceChild(p,a)}for(;s=o.firstChild;)e.appendChild(s);return e},param:function(t){if(!t||"string"==typeof t||"number"==typeof t)return t;var e=[],r=function(t,r){/native code/.test(r)||(r="function"==typeof r?r():r,r="[object File]"!==toS.call(r)?encode(r):r,e.push(encode(t)+"="+r))};return"object"==typeof t&&serialize("",t,r),e.join("&")},parseForm:function(t){for(var e,r={},o=0;e=t.elements[o++];)switch(e.type){case"select-one":case"select-multiple":if(e.name.length&&!e.disabled)for(var s,i=0;s=e.options[i++];)s.selected&&(r[e.name]=s.value||s.text);break;case"file":e.name.length&&!e.disabled&&(r[e.name]=e.files[0]);break;case void 0:case"submit":case"reset":case"button":break;case"radio":case"checkbox":if(!e.checked)break;default:e.name.length&&!e.disabled&&(r[e.name]=e.value)}return r},merge:function(t,e){if("object"!=typeof t||"object"!=typeof e)throw new TypeError("argument must be an object");if(Object.assign)return Object.assign(t,e);for(var r in e)t[r]=e[r];return t}};var F=new Format,requestConvert={text:function(t){return t},xml:function(t,e){return void 0!==e?e:F.parseXML(t)},html:function(t){return F.parseHTML(t)},json:function(t){return JSON.parse(t)},script:function(t){return F.parseJS(t)},jsonp:function(t){var e=request.cache[t];return delete request.cache[t],e}},requestExtend={formData:function(){if(this.opt.form){var t=F.parseForm(this.opt.form);F.merge(this.opt.data,t)}var e=new FormData;for(var r in this.opt.data){var o=this.opt.data[r];Array.isArray(o)?o.forEach(function(t){e.append(r+"[]",t)}):e.append(r,this.opt.data[r])}return e},jsonp:function(t){win[t]=function(e){delete win[t],request.cache[t]=e}},dispatch:function(t){if(this.transport){var e=this,r={response:{url:this.opt.url,headers:{"content-type":""}},request:{url:this.opt.url,headers:e.opt.headers},status:null===t?504:200,statusText:null===t?"Connected timeout":"ok",text:"",body:"",error:null};if(clearTimeout(e.opt.timeoutID),"object"==typeof this.transport&&"JSONP"===this.opt.type){if(null!==t){var o=!this.transport.readyState||"loaded"===this.transport.readyState||"complete"===this.transport.readyState;o&&(r.body=requestConvert.jsonp(this.opt.data.callback),r.text=JSON.stringify(r.body))}this.callback(r.error,r)}else{var s=t?t.status>=200&&t.status<300||304===t.status:!1,i=t&&t.getAllResponseHeaders().split("\n")||[];i.forEach(function(t){t=t.trim(),t&&(t=t.split(":"),r.response.headers[t.shift().toLowerCase()]=t.join(":").trim())}),s?(r.status=t.status,204===r.status?r.statusText="no content":304===r.status&&(r.statusText="not modified")):(r.status=null===t?504:t.status||500,r.statusText=null===t?"Connected timeout":t.statusText||"Internal Server Error",r.error=F.merge(new Error(r.statusText),{status:r.status}));try{var a=r.response.headers["content-type"].match(/json|xml|script|html/i)||["text"];a=a[0].toLowerCase(),r.text=t&&(t.responseText||t.responseXML)||"",r.body=requestConvert[a](r.text,t&&t.responseXML)}catch(n){r.error=n,r.statusText="parse error"}e.callback(r.error,r)}delete e.transport,delete e.opt,delete e.xhr}}};_requestp.type=function(t){return"form-data"===this.opt.formType?this:(this.opt.formType=t||"form","form"===t||"GET"===this.opt.type?this.set("content-type","application/x-www-form-urlencoded; charset=UTF-8"):this.set("content-type","application/json; charset=UTF-8"),this)},_requestp.set=function(t,e){if(this.transport){if("object"==typeof t)for(var r in t)r=r.toLowerCase(),this.opt.headers[r]=t[r];else{if("string"!=typeof t)throw new Error("arguments must be string/object, but ["+typeof t+"] given");if(arguments.length<2)throw new Error("2 arguments required");t=t.toLowerCase(),void 0===e?delete this.opt.headers[t]:this.opt.headers[t]=e}return this}},_requestp.send=function(t,e){if(this.transport){if("object"==typeof t){if(this.opt.data&&"string"==typeof this.opt.data)throw new Error("param can not be string and object at the same time");this.opt.data||(this.opt.data={}),F.merge(this.opt.data,t)}else{if("string"!=typeof t)throw new Error("argument of send must be string/object, but ["+typeof t+"] given");if(1===arguments.length){if(this.opt.data)throw new Error("invalid param in function send");this.opt.data=t}else{if(this.opt.data&&"string"==typeof this.opt.data)throw new Error("param can not be string and object at the same time");this.opt.data||(this.opt.data={}),this.opt.data[t]=e}}return this}},_requestp.field=function(t,e){if(this.transport){if(this.opt.formType="form-data",(!this.opt.data||this.opt.data&&"object"!=typeof this.opt.data)&&(this.opt.data={}),1===arguments.length&&"object"==typeof t)F.merge(this.opt.data,t);else{if(2!==arguments.length)throw new TypeError("argument must be an object, but "+typeof t+" given");this.opt.data[t]=e}return this}},_requestp.cache=function(t){return this.transport?("GET"===this.opt.type&&(this.opt.cache=!!t),this):void 0},_requestp.abort=function(){return delete this.transport,this.opt.form||this.xhr.abort(),this},_requestp.timeout=function(t){return"number"!=typeof t||1>t?this:(this.opt.timeout=t,this)},_requestp.form=function(t){return"object"==typeof t&&"FORM"===t.nodeName&&(this.opt.type="POST",this.opt.form=t),this};var originAnchor=doc.createElement("a");return originAnchor.href=location.href,_requestp.end=function(t){var e=this;if(this.transport){if(!this.opt.url)throw new Error("Invalid  request url");if(F.merge(this,requestExtend),this.callback=t||noop,this.opt.url=this.opt.url.replace(/#.*$/,"").replace(/^\/\//,location.protocol+"//"),"boolean"!=typeof this.opt.crossDomain){var r=doc.createElement("a");try{r.href=this.opt.url;var o="1"[0]?r.href:r.getAttribute("href",4);r.href=o,r.async=!0,this.opt.crossDomain=originAnchor.protocol!==r.protocol||originAnchor.host!==r.host}catch(s){this.opt.crossDomain=!0}}if("JSONP"===this.opt.type&&(this.opt.crossDomain?(this.opt.data.callback=this.opt.data.callback||"jsonp"+request.cid++,this.jsonp(this.opt.data.callback)):this.opt.type="GET"),this.opt.crossDomain||this.set("X-Requested-With","XMLHttpRequest"),this.opt.param=F.param(this.opt.data),this.opt.formType||this.type("form"),this.opt.hasContent="POST"===this.opt.type,this.opt.hasContent?"form-data"===this.opt.formType?(delete this.opt.headers["content-type"],this.opt.param=this.formData()):"form"!==this.opt.formType&&(this.opt.param=JSON.stringify(this.opt.data)):(this.opt.param&&(this.opt.url+=(/\?/.test(this.opt.url)?"&":"?")+this.opt.param),this.opt.cache===!1&&(this.opt.url+=(/\?/.test(this.opt.url)?"&":"?")+"_="+Math.random())),"JSONP"===this.opt.type)this.transport=doc.createElement("script"),this.transport.onerror=this.transport.onload=function(){e.dispatch(e.transport)},this.transport.src=this.opt.url,doc.head.insertBefore(this.transport,doc.head.firstChild),this.opt.timeout&&this.opt.timeout>0&&(this.opt.timeoutID=setTimeout(function(){e.transport.onerror=e.transport.onload=null,e.dispatch(null)},this.opt.timeout));else{this.xhr.onreadystatechange=function(t){e.opt.timeout&&e.opt.timeout>0&&(e.opt["time"+this.readyState]=t.timeStamp,4===this.readyState&&(e.opt.isTimeout=e.opt.time4-e.opt.time1>e.opt.timeout)),4===this.readyState&&e.dispatch(e.opt.isTimeout?null:e.xhr)},this.xhr.open(this.opt.type,this.opt.url,!0);for(var i in this.opt.headers)this.opt.headers[i]&&this.xhr.setRequestHeader(i,this.opt.headers[i]);e.xhr.send(e.opt.param),this.opt.timeout&&this.opt.timeout>0&&(this.xhr.timeout=this.opt.timeout)}}},win.request||(win.request={get:function(t){if(!t)throw new Error("argument url is required");return new _request(t,"GET")},post:function(t){if(!t)throw new Error("argument url is required");return new _request(t,"POST")},jsonp:function(t){if(!t)throw new Error("argument url is required");return new _request(t,"JSONP")},cache:{},cid:0,version:"1.0.0",release:"request ES5 version/1.0.0"}),request});